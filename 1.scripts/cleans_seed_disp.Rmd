---
title: "Cleaning Predispersal Seed Predation Data"
author: "Camila Vargas"
date: "12/9/2021"
output: html_document
---

## Set up

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)

## Load packages
library(here)
library(tidyverse)
library(janitor)
library(readxl)

## Sets R not to use scientific notations
options(scipen=999) 

raw_data_path <- here::here("6.raw_data/")
```


## Exploring data
```{r}

excel_sheets("6.raw_data/Predispersal_seed_predation.xls")

```

There are 17 sheets in the raw data file. 
Irrelevant sheets (8):
- UCSC_pivot
- Sheet2
- TECApivot
- All Chart# (4)
- pivot

Sheets with additional information (1)
- Key

Sheets to look into (8)
- Coco_data
- ucsc_spss - Subset of coco data
- Terminalia_data
- Teca_morphology
- tree list
- spss_Cocos_funiculus
- spss_predation_1
- spss_predation_2

## Read data

```{r}
coco_data_raw <- read_excel(here::here("6.raw_data/Predispersal_seed_predation.xls"), sheet = "Cocos_data") %>% 
  clean_names() %>% 
  select(1:11) ## all other columns are part of pivot table

```


## Clean and harmonize data

1. Coco Data
```{r}

coco_data <- coco_data_raw %>% 
  mutate(island = str_to_lower(island),
         funiculus_attacked = ifelse(funiculus_attacked == "n/a", NA, funiculus_attacked),
         genus = "cocos") %>% 
  rename(treatment = treatment_3)

```

**time range** 2005-08-10 UTC" "2005-11-02 UTC

2. ucsc spss

Is this a subset of cocos data??
```{r}

ucsc_spss_raw <- read_excel(here::here("6.raw_data/Predispersal_seed_predation.xls"), sheet = "ucsc spss") %>% 
  clean_names()

coco_subset <- coco_data_raw %>% 
  select(treatment = treatment_3, seed_class, fate)


all_equal(coco_subset, ucsc_spss_raw)

setdiff(coco_data$treatment, ucsc_spss_raw$treatment)
setdiff(ucsc_spss_raw$treatment, coco_data$treatment)

setdiff(coco_data$seed_class, ucsc_spss_raw$seed_class)
setdiff(ucsc_spss_raw$seed_class, coco_data$seed_class)

setdiff(coco_data$fate, ucsc_spss_raw$fate)
setdiff(ucsc_spss_raw$fate, coco_data$fate)

## Same data! We do not need this sheet
```


3. Terminalia_data
```{r}

term_data_raw <- read_excel(here::here("6.raw_data/Predispersal_seed_predation.xls"), sheet = "Terminalia_data") %>% 
  clean_names()

term_data <- term_data_raw %>% 
  mutate(manipulation_code = ifelse(manipulationcode == "n/a", NA, manipulationcode),
         genus = "terminalia") %>% 
  select(-manipulationcode)


```


4. Teca_morphology

Not sure what is this! Ask Alex
Is this table relevant for publishing?

```{r}
teca_morph_raw <- read_excel(here::here("6.raw_data/Predispersal_seed_predation.xls"), sheet = "Teca_morphology") %>% 
  clean_names()
```


5. tree list
Why is there only data for aviation, paradise and cooper.
Again, is this dataset relevant?
```{r}

tree_list_raw <- read_excel(here::here("6.raw_data/Predispersal_seed_predation.xls"), sheet = "tree list") %>% 
  clean_names()

```

6. spss_Cocos_funiculus

Need to know if this is relevant data. Or not

```{r}

coco_funi_raw <- read_excel(here::here("6.raw_data/Predispersal_seed_predation.xls"), sheet = "spss_Cocos_funiculus") %>% 
  clean_names()

```


7. spss_predation_1

Original data is in percentage. When read into R it is transform into decimals
```{r}
pred_1 <- read_excel(here::here("6.raw_data/Predispersal_seed_predation.xls"), sheet = "spss_predation_1") %>% 
  clean_names() %>% 
  select(1:7)
```

8. spss_predation_2
Column action% is transformed into decimals

```{r}
pred_2 <- read_excel(here::here("6.raw_data/Predispersal_seed_predation.xls"), sheet = "spss_predation_2") %>% 
  clean_names()
```



